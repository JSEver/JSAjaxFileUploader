(function(f,b){var d={uploadUrl:null,fileName:"file",inputText:"Select Files...",formData:{},allowExt:"gif|jpg|jpeg|png|bmp|mp4|mp3|pdf|doc|docx|xcl|txt",maxFileSize:5242880,beforesend:function(o){},always:function(o){},done:function(o,p){},fail:function(o){},progress:function(o,p){},complete:function(o,p){},success:function(o){},error:function(o){},showProgress:true,closeAnimationSpeed:500,zoomPreview:true,zoomWidth:160,zoomHeight:170};f.filePool=[];var e=false,g=0;f.fn.JSAjaxFileUploader=function(o){var q=f.extend({},d,o);var p=this;var r=['<form method="post" class="JSUploadForm" enctype="multipart/form-data" action=',q.url,">",'<label class="JSFileChoos"><input type="file" multiple style="display:none"/>',q.inputText,'</label><ul class="JSpreveiw"></ul></form>'];this.onChange=function(s,x){for(var w=0;w<x.originalEvent.target.files.length;w++){var t=x.originalEvent.target.files[w];var B=new RegExp(".("+q.allowExt+")$","i");var A=f("form ul.JSpreveiw",s);g++;var u=['<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop',g,'" title="Stop Upload"><img id="close',g,'" src="img/icons/delete.png" title="Close"></span>'];if(!(B.test(t.name))){var y='<span class="JSnotAllowed">File Type Not Suppoted!</span>';A.append(n(i(t),t,g,true,y));h(g,q.closeAnimationSpeed);continue}else{if(t.size>q.maxFileSize){var y='<span class="JSnotAllowed">File size '+m(t.size)+" greater than "+m(q.maxFileSize)+" Not Allowed!</span>";A.append(n(i(t),t,g,true,y));h(g,q.closeAnimationSpeed);continue}}if(!!t.type.match(/image.*/)){f.JSRender(s,t,q,g,u)}else{var z=f(n(i(t),t,g,true,""));f("form ul.JSpreveiw",s).append(z);var v={JSNode:s,file:t,settings:q,id:g};f.filePool.push(v)}}if(!e&&f.filePool.length>0){e=true;j(f.filePool.shift())}if(q.zoomPreview){f("form ul li table td img.JSThumbnail",this).JSEnlargeImage({zoomWidth:q.zoomWidth,zoomHeight:q.zoomHeight})}};return this.each(function(){var s=f(this);s.append(r.join(""));f('form input[type="file"]',s).change(function(t){p.onChange(s,t)})})};f.JSRender=function(p,r,s,v,u){var q=document.createElement("img");var o=new FileReader();o.onloadend=function(){q.src=o.result;f("#thimbImg"+v).attr("src",q.src)};o.readAsDataURL(r);f("form ul.JSpreveiw",p).append(n(q.src,r,v,true,""));f("form ul.JSpreveiw span#fileId"+(v)+"_spanPercent",p).html('<p style="font-size:9px;margin:0px">Waiting...</p>');var t={JSNode:p,file:r,settings:s,id:v};f.filePool.push(t)};var c={zoomWidth:"160",zoomHeight:"170"};f.fn.JSEnlargeImage=function(o){settings=f.extend({},c,o);return this.each(function(){f(this).off("mouseover,mouseout");f(this).on("mouseover",function(s){var t=s.pageY<settings.zoomHeight?settings.zoomHeight:s.pageY;var r=s.pageX+20;var q=(t-f(window).scrollTop()-settings.zoomHeight);var p=['<div id="JSEnlargePhotoTarget" style="display:none;position:fixed;z-index: 9999;width:',settings.zoomWidth,"px;height:",settings.zoomHeight,'px;border: 5px solid rgba(189, 189, 189, 0.59);"><img src="',f(this).attr("src"),'" style="width: inherit;height: inherit;"></img></div>'];f(p.join("")).insertAfter(this);f("#JSEnlargePhotoTarget").css({top:q,left:r}).fadeIn(200)}).on("mouseout",function(){f("#JSEnlargePhotoTarget").remove()})})};function k(o){return f.ajax({url:o.url,type:"POST",data:o.formData,processData:false,contentType:false,xhr:o.progress,beforeSend:function(){if(l(o.beforesend)){o.beforesend(o.file)}},success:function(p){if(l(o.onSuccess)){o.onSuccess(p)}},error:function(q,r,p){if(l(o.onError)){o.onError(q,r,p)}}})}function m(o){if(typeof o!=="number"){return""}if(o>=1000000000){return(o/1000000000).toFixed(2)+" GB"}if(o>=1000000){return(o/1000000).toFixed(2)+" MB"}return(o/1000).toFixed(2)+" KB"}var j=function(s){var r=s.JSNode,u=s.file,v=s.settings,p=s.id;var t=false;if(window.FormData){t=new FormData()}else{alert("Sorry file upload not supported in this browser!")}t.append(v.fileName,u,u.name);f.each(v.formData,function(C,B){t.append(C,B)});if(t){var y=f("#fileId"+(p)+"_span",r);var q=f("#fileId"+(p)+"_spanPercent",r);var w=f("#fileId"+(p),r);var x=f("img#stop"+p,r);var A=f("img#close"+p,r);var o=function(){var B=new window.XMLHttpRequest();B.upload.addEventListener("progress",function(C){if(l(v.progress)){v.progress(u,C)}if(v.showProgress&&C.lengthComputable){var E=((C.loaded/C.total)*100).toFixed();y.html(m(C.loaded)+" / "+m(C.total));w.css("width",E+"%");q.html(E+"% ");if(E>=100){var D=f("form ul.JSpreveiw li#JSfileLi"+(p),r);D.slideUp(v.closeAnimationSpeed,function(){D.remove()})}}},false);return B};var z=k({url:v.uploadUrl,file:u,formData:t,progress:o,beforesend:v.beforesend,onSuccess:v.success,onError:v.success});x.on("click",function(){if(z&&z.readystate!=4){z.abort()}x.off("click");w.css("background-image","linear-gradient(rgb(255, 129, 129) 20%, rgb(199, 5, 5) 90%)");q.append("Canceled...").css({"font-size":"12px",color:"red"});x.remove()});A.on("click",function(){if(z&&z.readystate!=4){z.abort()}var B=f("form ul.JSpreveiw li#JSfileLi"+(p),r);B.slideUp(v.closeAnimationSpeed,function(){B.remove()})});if(l(v.always)){z.always(function(){v.always(u)})}if(l(v.complete)){z.complete(function(){if(f.filePool.length>0){e=true;j(f.filePool.shift())}else{e=false}v.complete(u,z)})}if(l(v.done)){z.done(function(){v.done(u,z)})}if(l(v.fail)){z.fail(function(){v.fail(u,z)})}}};var i=function(p){var o=p.name.split(".");var q=o[o.length-1].toLowerCase();switch(q){case"pdf":return"img/icons/pdf.png";case"doc":return"img/icons/doc.png";case"docx":return"img/icons/docx.png";case"xls":return"img/icons/excel.png";case"xlsx":return"img/icons/excel.png";case"xml":return"img/icons/xml.png";case"txt":return"img/icons/txt.png";default:if(!!p.type.match(/audio.*/)){return"img/icons/music.png"}if(!!p.type.match(/video.*/)){return"img/icons/media.png"}return"img/icons/unknown.png"}};function n(r,q,t,p,s){var o;if(f(window).width()>350){o=['<li id="JSfileLi',t,'"><table style="width:100%"><tr><td rowspan=3 style="width: 60px;"><div style="width: 12px;text-align: center;"><img class="JSThumbnail" id="thimbImg',t,'" src="',r,'" width=50 height=50></div></td><td><span class="JSfilename">',a(q.name,30),"</span><td>",(p?('<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop'+t+'" title="Stop Upload">'):""),'<img id="close',t,'" src="img/icons/delete.png" title="Close"></span></td></tr>','<tr><td style="width:70%"><span class="JSpercent" id="fileId',t,'_spanPercent"></span>',s,'</td><td><span class="JSsize" id="fileId',t,'_span"></span></td></tr>','<tr><td colspan=2><div><div id="fileId',t,'" class="JSFileProgress"></div></div></td></tr></table></li>']}else{o=['<li id="JSfileLi',t,'"><table style="width:100%"><tr><td><span class="JSfilename">',a(q.name,20),"</span><td>",(p?('<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop'+t+'" title="Stop Upload">'):""),'<img id="close',t,'" src="img/icons/delete.png" title="Close"></span></td></tr>','<tr><td colspan=2 style="width: 60px;"><div style="text-align: center;"><img class="JSThumbnail" id="thimbImg',t,'" src="',r,'" width=30 height=30></div></td></tr>','<tr><td><span class="JSpercent" id="fileId',t,'_spanPercent"></span>',s,"</td></tr>",'<tr><td><span class="JSsize" id="fileId',t,'_span"></span></td></tr>','<tr><td colspan=2><div><div id="fileId',t,'" class="JSFileProgress"></div></div></td></tr></table></li>']}return o.join("")}var h=function(p,o){f("#close"+p).on("click",function(q){var r=f("#JSfileLi"+p);r.slideUp(o,function(){r.remove()})})};var a=function(o,p){if(o.length>p){return o.substring(0,5)+"..."+o.substr(o.length-6)}return o};var l=function(o){return(o!==b&&o!==null&&typeof o==="function")}})(jQuery);