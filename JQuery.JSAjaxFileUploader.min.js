(function(e,b){var d={uploadUrl:null,fileName:"file",inputText:"Select Files...",formData:{},autoSubmit:true,uploadTest:"Start Upload",allowExt:"gif|jpg|jpeg|png|bmp|mp4|mp3|pdf|doc|docx|xsl|txt",maxFileSize:5242880,beforesend:function(o){},always:function(o){},done:function(o,p){},fail:function(o){},progress:function(o,p){},complete:function(o,p){},success:function(o){},error:function(o){},showProgress:true,syncUploads:false,closeAnimationSpeed:500,zoomPreview:true,zoomWidth:160,zoomHeight:170};var f=0;e.filePool={};e.fn.JSAjaxFileUploader=function(o){var q=e.extend({},d,o);var p=this;var r=['<form method="post" class="JSUploadForm" enctype="multipart/form-data" action=',q.url,">",'<label class="JSFileChoos"><input type="file" multiple style="display:none"/>',q.inputText,"</label>",(q.autoSubmit?"":'<label class="JSFileCount"></label><a href="#" class="startJSuploadButton" >'+q.uploadTest+"</a>"),'<ul class="JSpreveiw"></ul></form>'];this.onChange=function(t,s){for(var x=0;x<s.length;x++){var u=s[x];var B=new RegExp(".("+q.allowExt+")$","i");var A=e("form ul.JSpreveiw",t);f++;var v=['<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop',f,'" title="Stop Upload"><img id="close',f,'" src="img/icons/delete.png" title="Close"></span>'];if(!(B.test(u.name))){var y='<span class="JSnotAllowed">File Type Not Suppoted!</span>';A.append(n(i(u),u,f,true,y));h(f,q.closeAnimationSpeed);e.closeClicked(q);continue}else{if(u.size>q.maxFileSize){var y='<span class="JSnotAllowed">File size '+m(u.size)+" greater than "+m(q.maxFileSize)+" Not Allowed!</span>";A.append(n(i(u),u,f,true,y));h(f,q.closeAnimationSpeed);e.closeClicked(q);continue}}if(!!u.type.match(/image.*/)){e.JSRender(t,u,q,f,v)}else{var z=e(n(i(u),u,f,true,""));e("form ul.JSpreveiw",t).append(z);var w={JSNode:t,file:u,settings:q,id:f};e.startUpload(t,q,w)}}if(q.zoomPreview){e("form ul li table td img.JSThumbnail",this).JSEnlargeImage({zoomWidth:q.zoomWidth,zoomHeight:q.zoomHeight})}};return this.each(function(){var s=e(this);s.html(r.join(""));e.filePool[s]=[];e.filePool[s+"uploading"]=false;if(q.autoSubmit){e('form input[type="file"]',s).change(function(u){p.onChange(s,u.originalEvent.target.files);e(this).val("")})}else{var t=null;e('form input[type="file"]',s).change(function(u){t=u.originalEvent.target.files;e("form label.JSFileCount",s).html(t.length+" file(s) selected")});e("form .startJSuploadButton",s).click(function(u){u.preventDefault();if(t==null||t==b||t.length<=0){alert("No Files Selected");return}p.onChange(s,t);e(this).val("")})}})};e.startUpload=function(o,p,q){if(p.syncUploads===true){if(!e.filePool[o+"uploading"]){j(q);e.filePool[o+"uploading"]=true}else{e.filePool[o].push(q);e.closeClicked(p)}}else{j(q)}};e.closeClicked=function(o){e(".JSCloaseButton").off("click").on("click",function(){e("#JSfileLi"+(e(this).attr("index"))).slideUp(o.closeAnimationSpeed)})};e.JSRender=function(p,r,s,v,u){var q=document.createElement("img");var o=new FileReader();o.onloadend=function(){q.src=o.result;e("#thimbImg"+v).attr("src",q.src)};o.readAsDataURL(r);e("form ul.JSpreveiw",p).append(n(q.src,r,v,true,""));e("form ul.JSpreveiw span#fileId"+(v)+"_spanPercent",p).html('<p style="font-size:9px;margin:0px">Waiting...</p>');var t={JSNode:p,file:r,settings:s,id:v};e.startUpload(p,s,t)};var c={zoomWidth:"160",zoomHeight:"170"};e.fn.JSEnlargeImage=function(o){settings=e.extend({},c,o);return this.each(function(){e(this).off("mouseover,mouseout");e(this).on("mouseover",function(s){var t=s.pageY<settings.zoomHeight?settings.zoomHeight:s.pageY;var r=s.pageX+20;var q=(t-e(window).scrollTop()-settings.zoomHeight);var p=['<div id="JSEnlargePhotoTarget" style="display:none;position:fixed;z-index: 9999;width:',settings.zoomWidth,"px;height:",settings.zoomHeight,'px;border: 5px solid rgba(189, 189, 189, 0.59);"><img src="',e(this).attr("src"),'" style="width: inherit;height: inherit;"></img></div>'];e(p.join("")).insertAfter(this);e("#JSEnlargePhotoTarget").css({top:q,left:r}).fadeIn(200)}).on("mouseout",function(){e("#JSEnlargePhotoTarget").remove()})})};function k(o){return e.ajax({url:o.url,type:"POST",data:o.formData,processData:false,contentType:false,xhr:o.progress,beforeSend:function(){if(l(o.beforesend)){o.beforesend(o.file)}},success:function(p){if(l(o.onSuccess)){o.onSuccess(p)}},error:function(q,r,p){if(l(o.onError)){o.onError(q,r,p)}}})}function m(o){if(typeof o!=="number"){return""}if(o>=1000000000){return(o/1000000000).toFixed(2)+" GB"}if(o>=1000000){return(o/1000000).toFixed(2)+" MB"}return(o/1000).toFixed(2)+" KB"}var j=function(s){var r=s.JSNode,u=s.file,v=s.settings,p=s.id;var t=false;if(window.FormData){t=new FormData()}else{alert("Sorry file upload not supported in this browser!")}t.append(v.fileName,u,u.name);e.each(v.formData,function(C,B){t.append(C,B)});if(t){var y=e("#fileId"+(p)+"_span",r);var q=e("#fileId"+(p)+"_spanPercent",r);var w=e("#fileId"+(p),r);var x=e("img#stop"+p,r);var A=e("img#close"+p,r);var o=function(){var B=new window.XMLHttpRequest();B.upload.addEventListener("progress",function(C){if(l(v.progress)){v.progress(u,C)}if(v.showProgress&&C.lengthComputable){var E=((C.loaded/C.total)*100).toFixed();y.html(m(C.loaded)+" / "+m(C.total));w.css("width",E+"%");q.html(E+"% ");if(E>=100){var D=e("form ul.JSpreveiw li#JSfileLi"+(p),r);D.slideUp(v.closeAnimationSpeed,function(){D.remove()});g(v,r)}}},false);return B};var z=k({url:v.uploadUrl,file:u,formData:t,progress:o,beforesend:v.beforesend,onSuccess:v.success,onError:v.success});x.on("click",function(){g(v,r);if(z&&z.readystate!=4){z.abort()}x.off("click");w.css("background-image","linear-gradient(rgb(255, 129, 129) 20%, rgb(199, 5, 5) 90%)");q.append("Canceled...").css({"font-size":"12px",color:"red"});x.remove()});A.off("click").on("click",function(){g(v,r);if(z&&z.readystate!=4){z.abort()}var B=e("form ul.JSpreveiw li#JSfileLi"+(p),r);B.slideUp(v.closeAnimationSpeed,function(){B.remove()})});if(l(v.always)){z.always(function(){v.always(u)})}if(l(v.complete)){z.complete(function(){v.complete(u,z)})}if(l(v.done)){z.done(function(){v.done(u,z)})}if(l(v.fail)){z.fail(function(){v.fail(u,z)})}}};var i=function(p){var o=p.name.split(".");var q=o[o.length-1].toLowerCase();switch(q){case"pdf":return"img/icons/pdf.png";case"doc":return"img/icons/doc.png";case"docx":return"img/icons/docx.png";case"xls":return"img/icons/excel.png";case"xlsx":return"img/icons/excel.png";case"xml":return"img/icons/xml.png";case"txt":return"img/icons/txt.png";default:if(!!p.type.match(/audio.*/)){return"img/icons/music.png"}if(!!p.type.match(/video.*/)){return"img/icons/media.png"}return"img/icons/unknown.png"}};function n(r,q,t,p,s){var o;if(e(window).width()>400){o=['<li id="JSfileLi',t,'"><table style="width:100%"><tr><td rowspan=3 style="width: 60px;"><div style="width: 12px;text-align: center;"><img class="JSThumbnail" id="thimbImg',t,'" src="',r,'" width=50 height=50></div></td><td><span class="JSfilename">',a(q.name,30),"</span><td>",(p?('<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop'+t+'" title="Stop Upload">'):""),'<img class="JSCloaseButton" id="close',t,'" index="',t,'" src="img/icons/delete.png" title="Close"></span></td></tr>','<tr><td style="width:70%"><span class="JSpercent" id="fileId',t,'_spanPercent"></span>',s,'</td><td><span class="JSsize" id="fileId',t,'_span"></span></td></tr>','<tr><td colspan=2><div class="JSProgressBarParent"><div id="fileId',t,'" class="JSFileProgress"></div></div></td></tr></table></li>']}else{o=['<li id="JSfileLi',t,'"><table style="width:100%"><tr><td><span class="JSfilename">',a(q.name,20),"</span><td>",(p?('<span class="JSOprIcons"><img src="img/icons/stop.png" id="stop'+t+'" title="Stop Upload">'):""),'<img class="JSCloaseButton" id="close',t,'" index="',t,'" src="img/icons/delete.png" title="Close"></span></td></tr>','<tr><td colspan=2 style="width: 60px;"><div style="text-align: center;"><img class="JSThumbnail" id="thimbImg',t,'" src="',r,'" width=30 height=30></div></td></tr>','<tr><td><span class="JSpercent" id="fileId',t,'_spanPercent"></span>',s,"</td>",'<td><span class="JSsize" style="font-size: 9px;" id="fileId',t,'_span"></span></td></tr>','<tr><td colspan=2><div class="JSProgressBarParent"><div id="fileId',t,'" class="JSFileProgress"></div></div></td></tr></table></li>']}return o.join("")}var h=function(p,o){e("#close"+p).on("click",function(q){var r=e("#JSfileLi"+p);r.slideUp(o,function(){r.remove()})})};var a=function(o,p){if(o.length>p){return o.substring(0,(p/2))+"..."+o.substr(o.length-(p/2))}return o};var l=function(o){return(o!==b&&o!==null&&typeof o==="function")};var g=function(p,o){if(p.syncUploads===true&&e.filePool[o].length>0){j(e.filePool[o].shift())}else{e.filePool[o+"uploading"]=false}}})(jQuery);